pipeline {
    agent any
    stages {
        stage("Git checkout") {
            steps {
                git 'https://github.com/AmolMandloi/junit-sample-project.git'
            }
        }
        stage("Maven") {
            steps {
                bat "mvn clean test"
            }
        }
        stage("build & SonarQube analysis") {
            steps {
    withSonarQubeEnv('sonar') {
                
                bat 'mvn clean verify sonar:sonar'
              }    } }
            
       stage("Quality Gate"){
    options {
        timeout(time: 5, unit: 'MINUTES') 
    }
    steps {
        script {
            def qg = waitForQualityGate()
            if (qg.status != 'OK') {
                error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }}
    }
}

    /*stage("Nexus Artifact Uploader") {
        steps {
            nexusArtifactUploader artifacts: [[artifactId: 'spring-boot-web-thymeleaf8', classifier: '', file: 'C:\\Program Files (x86)\\Jenkins\\workspace\\nexus\\target\\spring-boot-web-thymeleaf-1.0.war', type: 'war']], credentialsId: 'nexus', groupId: 'org.springframework.boot', nexusUrl: 'localhost:8081', nexusVersion: 'nexus3', protocol: 'http', repository: 'sample-release', version: '1.0'
        }
    }   */
      
        
        stage("Final") {
            steps{
                bat 'echo "All done"'
            }
        }
        
    }
}
